#!/usr/bin/env perl

use strict;
use warnings;

use FindBin::libs;
use Ouch;
use Test::More;

use Test::BDD::Cucumber::Parser;
use Test::BDD::Cucumber::Executor;
use Test::BDD::Cucumber::Harness::TestBuilder;
use Test::BDD::Cucumber::StepFile(); # Don't load Given and Then

my $base_dir = $ARGV[0];

my $executor = Test::BDD::Cucumber::Executor->new();

Test::BDD::Cucumber::StepFile->read_dir( $ARGV[0] . '/features/step_definitions/' );
$executor->add_steps( Test::BDD::Cucumber::StepFile->all );

my $feature = eval { Test::BDD::Cucumber::Parser->parse_file(
	$ARGV[0] . '/features/basic.feature' ) };

if ( hug ) {
	warn $@->scalar;
	warn $@->data->debug_summary;
	die;
}

my $harness = Test::BDD::Cucumber::Harness::TestBuilder->new();
$executor->execute( $feature, $harness );

done_testing;
