#!perl

use strict;
use warnings;
use FindBin::libs;

use Ouch;
use Method::Signatures;
use Test::BDD::Parser;
use Test::BDD::Executor;

my $feature = eval { Test::BDD::Parser->parse_file(
	't/fsets/parser/feature_parser.feature' ) };

if ( hug ) {
	warn $@->scalar;
	warn $@->data->debug_summary;
	die;
}

my $executor = Test::BDD::Executor->new();

$executor->add_steps(
    [ given => 'a feature parser' => method ($c) {} ],
    [ given => 'the following text is parsed', method ($c) {
        die "Only accepts a string" if ref $c->data;

        # Attempt to parse
        my $test_feature = eval { Test::BDD::Parser->parse_string(
            $c->data ) };

        # Save the output and any errors
        $c->stash->{'scenario'}->{'feature'} = $test_feature;
        $c->stash->{'scenario'}->{'errors'}  = $@;

    } ],
);
$executor->execute( $feature );

